#!/usr/bin/env bash
# shellcheck disable=2139

#----- general

alias c=clear
alias so="source ${HOME}/.bashrc"
alias wget="wget --hsts-file $XDG_CACHE_HOME/wget-hsts"

#----- colors

alias diff='diff --minimal --color=always '
alias grep='grep --color=auto --exclude-dir=.git'
alias la='ls -hla --time-style=long-iso'
alias ip='ip -color=always'

if [[ "$OSTYPE" == "linux-gnu"* ]]; then
  alias ls="LC_COLLATE=C ls --color=auto --group-directories-first"
elif [[ "$OSTYPE" == "freebsd"* ]]; then
  alias ls="LC_COLLATE=C ls --color=auto"
fi

#----- utils

alias whereami="curl -s https://am.i.mullvad.net/json | jq '.'"
alias ipme="curl -s https://ip.me"

#----- dirs

alias uxh="cd $XDG_CONFIG_HOME"
alias uxd="cd $XDG_DATA_HOME"
alias uxc="cd $XDG_CACHE_HOME"
alias uxs="cd $XDG_STATE_HOME"

#----- git

alias ga='git add'
alias gb='git branch'
alias gc='git checkout'
alias gd='git diff'
alias gdc='git diff --cached'
alias gf='git fetch --prune'
alias gs='git status'
alias gl='git log --oneline -15'
alias gll='git log --oneline'

# cd to repo's root
alias cdg='cd $(git rev-parse --show-toplevel)'

# get remote's url
alias ggu='git remote get-url --no-all origin'

# completely remove all unreachable objects from the repository.
alias ggc='git -c gc.reflogExpireUnreachable=now gc --prune=now'

if [ -n "$BASH" ] && type __git_complete &>/dev/null; then
	__git_complete gb _git_branch
	__git_complete gc _git_checkout
	__git_complete gd _git_diff
	__git_complete gdc _git_diff
	__git_complete gf _git_fetch
	__git_complete gs _git_status
	__git_complete gl _git_log
	__git_complete gll _git_log
fi

#----- Docker

if hash docker 2> /dev/null; then

  alias dr=docker
  alias dk='docker compose'

  alias dpa='docker ps --all'
  alias dps='docker ps --format="table {{.Names}}\\t{{.Image}}\\t{{.Status}}\\t{{ .Ports }}\\t{{.RunningFor}}\\t{{.Command}}\\t{{ .ID }}" | cut -c-$(tput cols)'
  alias dls='docker ps -a --format="table {{.Names}}\\t{{.Image}}\\t{{.Status}}\\t{{ .Ports }}\\t{{.RunningFor}}\\t{{.Command}}\\t{{ .ID }}" | cut -c-$(tput cols)'

  alias dim='docker images --format="table {{.Repository}}\\t{{.Tag}}\\t{{.ID}}\\t{{.Size}}\\t{{.CreatedSince}}"'
  alias dip='docker image prune -f'

  alias dih='docker history --no-trunc --format="{{ .CreatedBy }}"'
  alias din='docker inspect --format="{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}"'

  alias dvl='docker volume ls -qf dangling=true'
  alias dvr='docker volume ls -qf dangling=true | xargs docker volume rm'

  alias dtop='docker stats $(docker ps --format="{{.Names}}")'

  # shellcheck disable=2154
  alias dnet='docker network ls && echo && docker inspect --format "{{\$e := . }}{{with .NetworkSettings}} {{\$e.Name}}
  {{range \$index, \$net := .Networks}}  - {{\$index}}  {{.IPAddress}}
  {{end}}{{end}}" $(docker ps -q)'

  # shellcheck disable=2154
  alias dtag='docker inspect --format "{{.Name}}
  {{range \$index, \$label := .Config.Labels}}  - {{\$index}}={{\$label}}
  {{end}}" $(docker ps -q)'

  if [ -n "$BASH" ] && type _complete_alias &>/dev/null; then
    complete -F _complete_alias dr
    complete -F _complete_alias dk
    complete -F _complete_alias dim
    complete -F _complete_alias dih
  fi
fi
